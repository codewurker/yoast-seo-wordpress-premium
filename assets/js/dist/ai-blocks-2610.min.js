(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.lodash,s=window.wp.blocks,r=window.wp.blockEditor,o=window.wp.components,a=window.wp.data,n=window.wp.element,i=window.wp.i18n,l=window.yoast.aiFrontend,u=window.yoast.uiLibrary,c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"version":"23.0","name":"yoast-seo/ai-summarize","title":"Yoast AI Summarize","description":"Adds a short AI summary of your content.","category":"yoast-ai-blocks","icon":"editor-ul","keywords":["summary","tldr","key takeaways"],"textdomain":"wordpress-seo-premium","attributes":{"title":{"type":"string","source":"html","selector":"h1,h2,h3,h4,h5,h6","default":"Key Takeaways"},"level":{"type":"number","default":2},"status":{"type":"string","default":"idle"}},"allowedBlocks":["core/list","core/list-item"],"supports":{"html":true,"multiple":false},"example":{"attributes":{"title":"Key Takeaways","level":2,"status":"loaded"},"innerBlocks":[{"name":"core/list","innerBlocks":[{"name":"core/list-item","attributes":{"content":"First key takeaway from the content"}},{"name":"core/list-item","attributes":{"content":"Second important point to remember"}},{"name":"core/list-item","attributes":{"content":"Third summary point for quick reference"}}]}]}}'),d="yoast-seo/editor",m={blockEditor:"core/block-editor"},p="idle",y="error",h=((0,i.__)("AI - Keyphrase density","wordpress-seo-premium"),(0,i.__)("Use keyphrase words in the text frequently but not excessively.","wordpress-seo-premium"),(0,i.__)("AI - Keyphrase in introduction","wordpress-seo-premium"),(0,i.__)("Include words from the keyphrase in the first paragraph of the text.","wordpress-seo-premium"),(0,i.__)("AI - Keyphrase distribution","wordpress-seo-premium"),(0,i.__)("Evenly distribute keyphrase words throughout the text.","wordpress-seo-premium"),(0,i.__)("AI - Keyphrase in subheadings","wordpress-seo-premium"),(0,i.__)("Include at least one word from the keyphrase in each subheading.","wordpress-seo-premium"),(0,i.__)("AI - Sentence length","wordpress-seo-premium"),(0,i.__)("Ensure long sentences are shortened or split for better readability.","wordpress-seo-premium"),(0,i.__)("AI - Paragraph length","wordpress-seo-premium"),(0,i.__)("Ensure long paragraphs are shortened or split for better readability.","wordpress-seo-premium"),"yoast-seo/ai-generator"),g="yoast-seo-premium/ai-summarize",b=["core/paragraph","core/heading","core/list-item","core/table","core/details","core/media-text","core/freeform","core/preformatted","yoast/faq-block","yoast/how-to-block"],w=window.yoast.reduxJsToolkit,k="generatedSummary",f=(0,w.createSlice)({name:k,initialState:{status:p,error:{code:200,message:"",errorIdentifier:""},summary:{title:"Key Takeaways",points:[]}},reducers:{setLoading:e=>{e.status="loading"},setSuccess:(e,{payload:t})=>{e.status="success",e.summary.points=t.data},setError:(e,{payload:t})=>{e.status=y,e.error=t},setErrorStatus:e=>{e.status=y},setIdleStatus:e=>{e.status=p},updateSummaryPoint:(e,{payload:t})=>{const{index:s,content:r}=t;e.summary.points[s]&&(e.summary.points[s]=r)},updateSummaryTitle:(e,{payload:t})=>{e.summary.title=t},updateSummaryPoints:(e,{payload:t})=>{e.summary.points=t}}}),x=f.getInitialState,S={selectGeneratedSummary:e=>(0,t.get)(e,k,""),getSummaryPoints:e=>(0,t.get)(e,[k,"summary","points"],[]),getSummaryTitle:e=>(0,t.get)(e,[k,"summary","title"],""),getFetchError:e=>(0,t.get)(e,[k,"error"],{})},_=f.actions,C=f.reducer,v="promptContentSummarize",j=(0,w.createSlice)({name:v,initialState:{text:"",length:0},reducers:{setPromptContentSummarize:(e,{payload:t})=>t}}),E=j.getInitialState,I={selectPromptContentSummarize:e=>(0,t.get)(e,v,"")},M=j.actions,B=j.reducer,R="AISummarizeButton",A=(0,w.createSlice)({name:R,initialState:{disabledAIButtonsReason:""},reducers:{disableAISummarizeButtons:(e,{payload:t})=>{e.disabledAIButtonsReason=t}}}),L=A.getInitialState,T={getDisabledAISummarizeButtonsReason:e=>(0,t.get)(e,[R,"disabledAIButtonsReason"],"")},z=A.actions,q=A.reducer,P=window.React,N=P.forwardRef((function(e,t){return P.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),P.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"}))})),O=window.yoast.propTypes;var F=e.n(O);const G=window.ReactJSXRuntime,U=()=>(0,G.jsxs)("div",{className:"yst-flex yst-items-center yst-gap-2",children:[(0,G.jsx)(o.Spinner,{}),(0,G.jsx)("span",{children:(0,i.__)("Summary is being generated...","wordpress-seo-premium")})]}),D=(e,t)=>{try{return(0,n.createInterpolateElement)(e,t)}catch(t){return console.error("Error in translation for:",e,t),e}},K=()=>(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{children:(0,i.__)("Generate a quick summary highlighting the main takeaways from your content.","wordpress-seo-premium")}),(0,G.jsx)("div",{children:(0,i.__)("We suggest placing the summary at the top of your article to help busy readers quickly understand the value.","wordpress-seo-premium")}),(0,G.jsx)("div",{children:D((0,i.__)("<em><strong>Tip: </strong>For the most accurate summary, finalize your content before generating the summary.</em>","wordpress-seo-premium"),{em:(0,G.jsx)("em",{}),strong:(0,G.jsx)("strong",{})})})]}),H=({loading:e,onGenerate:t,isUsageCountLoading:s})=>{const{counts:r,limit:c,disableAIButtonsReason:d}=(0,a.useSelect)((e=>({counts:e(h).selectUsageCount(),limit:e(h).selectUsageCountLimit(),disableAIButtonsReason:e(g).getDisabledAISummarizeButtonsReason()})),[]),m=(0,n.useMemo)((()=>""!==d),[d]),[p,y]=(0,n.useState)(!1),b=(0,n.useCallback)((()=>{m&&y(!0)}),[m]),w=(0,n.useCallback)((()=>{y(!1)}),[]);return(0,G.jsxs)(o.Placeholder,{label:(0,i.__)("AI Summarize","wordpress-seo-premium"),icon:"editor-ul",children:[e&&(0,G.jsx)(U,{}),!e&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(K,{}),(0,G.jsx)("div",{className:"yst-mt-1",children:(0,G.jsxs)("div",{onMouseEnter:b,onMouseLeave:w,children:[p&&(0,G.jsx)("div",{className:"yst-root yst-relative",children:(0,G.jsx)(u.Tooltip,{children:d})}),(0,G.jsxs)(o.Button,{id:"yst-ai-summarize-btn",className:"yst-w-full yst-flex yst-items-center yst-gap-2"+(m?"  yst-opacity-50":""),onClick:t,isPrimary:!0,disabled:m,children:[(0,G.jsx)(N,{className:"yst-inline-block yst-align-middle yst-fill-none yst-w-4 yst-h-4"}),(0,G.jsx)("span",{children:(0,i.__)("Generate summary","wordpress-seo-premium")})]})]})}),(0,G.jsxs)("div",{className:"yst-flex yst-items-center yst-gap-2",children:[(0,G.jsx)("div",{className:"yst-relative",children:(0,G.jsx)(l.UsageCounter,{className:"yst-root"+(s?" yst-mb-4":""),limit:c,requests:r,isSkeleton:s})}),!s&&(0,G.jsx)("p",{className:"yst-text-slate-500",children:D((0,i.__)("<em>You're about to use 1 spark.</em>","wordpress-seo-premium"),{em:(0,G.jsx)("em",{})})})]})]})]})};H.propTypes={loading:F().bool.isRequired,onGenerate:F().func.isRequired,isUsageCountLoading:F().bool.isRequired};const V=({level:e,title:t,setAttributes:s})=>{const{updateSummaryTitle:o}=(0,a.useDispatch)(g),l=(0,n.useCallback)((e=>{s({title:e}),o(e)}),[s]);return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(r.RichText,{tagName:`h${e}`,value:t||(0,i.__)("Key Takeaways","wordpress-seo-premium"),onChange:l}),(0,G.jsx)(r.InnerBlocks,{template:[["core/list",{className:"yoast-ai-summarize-list"}]],templateLock:"all"})]})};V.propTypes={level:F().number.isRequired,title:F().string.isRequired,setAttributes:F().func.isRequired};const W=["core/quote","core/cover","yoast-seo/ai-summarize"],Y=(e,t)=>e.reduce(((e,r)=>(e=>{var t;return!!(W.includes(e.name)||null!==(t=e.attributes)&&void 0!==t&&t.className&&e.attributes.className.includes("yoast-ai-summarize-list")||(e=>{var t;return!(t=(0,s.getBlockContent)(e),(new DOMParser).parseFromString(t,"text/html").documentElement.textContent).trim()})(e))})(r)?e:t.includes(r.name)?[...e,r]:r.innerBlocks.length>0?[...e,...Y(r.innerBlocks,t)]:e),[]),J={ja:e=>Math.round(e.length/2),default:e=>Math.round(e.length/4)},$=e=>{const{setOnStore:t,activeMarker:r}=e;if(r)return;const o=(()=>{const{getBlocks:e}=(0,a.select)(m.blockEditor),t=Y(e(),b).map((e=>(0,s.getBlockContent)(e))).join("\n");return{text:t,length:(e=>{const t=(0,a.select)(d).getContentLocale();return(J[t]||J.default)(e)})(t)}})();(e=>{const{disableAISummarizeButtons:t}=(0,a.dispatch)(g);t(e<200?(0,i.__)("Please add more content to ensure a valuable AI suggestion.","wordpress-seo-premium"):e>1e4?(0,i.__)("Your text is too long for the AI model to process.","wordpress-seo-premium"):"")})(o.length),t(o)},Q=()=>{const{getActiveMarker:e}=(0,a.select)(d),{setPromptContentSummarize:t}=(0,a.dispatch)(g);return()=>{const s=e();$({setOnStore:t,activeMarker:s})}},X=(0,t.get)(window,"yoast.editorModules.aiGenerator.components.FeatureError",t.noop),Z=({isFeatureErrorModalOpen:e,aiModalHelperLink:t,onClose:s})=>{const{currentSubscriptions:r}=(0,a.useSelect)((e=>({currentSubscriptions:e(h).selectProductSubscriptions()})),[]);return(0,G.jsx)(l.ErrorModal,{title:(0,i.__)("AI Summary","wordpress-seo-premium"),isOpen:e,badgeText:(0,i.__)("Beta","wordpress-seo-premium"),aiModalHelperLink:t,onClose:s,children:(0,G.jsx)(X,{currentSubscriptions:r})})};Z.propTypes={isFeatureErrorModalOpen:F().bool.isRequired,aiModalHelperLink:F().string.isRequired,onClose:F().func.isRequired};const ee=(0,t.get)(window,"yoast.editorModules.aiGenerator.components.Introduction",t.noop),te=({shouldOpen:e,handleClose:t,handleStartGenerating:s,initialFocus:r})=>{const o=(0,i.__)("Close modal","wordpress-seo-premium");return(0,G.jsx)(u.Modal,{className:"yst-introduction-modal",isOpen:e,onClose:t,initialFocus:r,children:(0,G.jsx)(u.Modal.Panel,{className:"yst-max-w-lg yst-p-0 yst-rounded-3xl",closeButtonScreenReaderText:o,children:(0,G.jsx)(ee,{onStartGenerating:s})})})};te.propTypes={shouldOpen:F().bool.isRequired,handleClose:F().func.isRequired,handleStartGenerating:F().func.isRequired,initialFocus:F().object.isRequired};const se=(0,t.get)(window,"yoast.editorModules.aiGenerator.components.SuggestionError",t.noop),re=(0,t.get)(c,"example",{});window.jQuery(window).on("YoastSEO:ready",(()=>{Q(),(0,a.subscribe)((0,t.debounce)((()=>{const{getEditorDataContent:e}=(0,a.select)(d),s=(0,t.get)(window,"yoast.editorModules.helpers.createWatcher",t.noop),r=Q();return setTimeout(r,1500),s(e,r)})(),1500,{maxWait:3e3}))})),((e={})=>{(0,a.register)((e=>(0,a.createReduxStore)(g,{actions:{..._,...M,...z},selectors:{...S,...I,...T},initialState:(0,t.merge)({},{[k]:x(),[v]:E(),[R]:L()},e),reducer:(0,a.combineReducers)({[k]:C,[v]:B,[R]:q})}))(e))})(),(0,s.registerBlockType)(c,{edit({attributes:e,setAttributes:c,clientId:p}){const{title:y,level:b,status:w}=e,{fetchUsageCount:k}=(0,a.useDispatch)(h),{removeBlock:f,replaceInnerBlocks:x}=(0,a.useDispatch)(m.blockEditor),{updateSummaryPoints:S,setIdleStatus:_,setErrorStatus:C}=(0,a.useDispatch)(g),{usageCountEndpoint:v,hasConsent:j,usageCount:E,hasValidPremiumSubscription:I,aiModalHelperLink:M,disableAIButtonsReason:B,summary:R,block:A,fetchError:L,usageCountError:T}=(0,a.useSelect)((e=>({usageCountEndpoint:e(h).selectUsageCountEndpoint(),usageCount:e(h).selectUsageCount(),usageCountError:e(h).selectUsageCountError(),disableAIButtonsReason:e(g).getDisabledAISummarizeButtonsReason(),summary:e(g).getSummaryPoints(),block:e(m.blockEditor).getBlock(p),hasConsent:e(h).selectHasAiGeneratorConsent(),hasValidPremiumSubscription:e(h).selectPremiumSubscription(),aiModalHelperLink:e(d).selectLink("https://yoa.st/ai-summarize-help-button"),fetchError:e(g).getFetchError()})),[]),[z,q]=(0,n.useState)(!1),[P,N]=(0,n.useState)(!1),[O,F]=(0,n.useState)(!j&&I),[U,D]=(0,n.useState)(!1),[K,W]=(0,n.useState)(!1),Y=function(){const[e,t]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const e=document.querySelector(".block-editor-block-switcher__container");if(!e)return;const s=()=>{t(!!e.querySelector(".block-editor-block-switcher__transforms__menugroup"))},r=new MutationObserver(s);return r.observe(e,{childList:!0,subtree:!0}),s(),()=>r.disconnect()}),[]),e}(),[J,$]=(0,n.useState)(!1),Q=(0,n.useMemo)((()=>""!==B),[B]),X=(0,n.useRef)(null),ee=(0,r.useBlockProps)({className:"yoast-ai-summarize"}),oe=(0,n.useRef)(!1),ae=(0,n.useCallback)((async()=>{if(!I)return W(!0),void C();if(!j)return void F(!0);q(!0),c({status:"loading"});const e=await(async()=>{const e=(0,t.get)(window,"yoast.editorModules.aiGenerator.helpers.fetchSuggestions",t.noop),s=(0,t.get)(window,"yoast.editorModules.aiGenerator.helpers.removesLocaleVariantSuffixes",t.noop),{fetchUsageCount:r}=(0,a.dispatch)(h),o=(0,a.select)(h).selectUsageCountEndpoint(),n=(0,a.select)(d).getContentLocale(),i=(0,a.select)(d).getFocusKeyphrase(),l=(0,a.select)(g).selectPromptContentSummarize().text,{setLoading:u,setError:c,setSuccess:m}=(0,a.dispatch)(g);u();const{status:p,payload:y}=await e({endpoint:"yoast/v1/ai/summarize",canAbort:!0,data:{language:s(n).replace("_","-"),focus_keyphrase:i,prompt_content:l}});switch(p){case"abort":break;case"error":c(y);break;case"success":y?(m({data:y}),r({endpoint:o})):c(y)}return{summary:y,status:p}})();"success"===e.status?(oe.current=!0,c({status:"loaded"}),D(!1),_()):"error"===e.status&&(D(!0),c({status:"failed"})),q(!1)}),[q,c,j,I,D,_]),ne=A.innerBlocks,ie=ne.find((e=>"core/list"===e.name)),le=(0,n.useMemo)((()=>{var e,s;if(!ie||!ie.innerBlocks.length)return!1;const r=ie.innerBlocks[0];return(0,t.isEqual)(A.attributes,re.attributes)&&"First key takeaway from the content"===(null==r||null===(e=r.attributes)||void 0===e||null===(s=e.content)||void 0===s?void 0:s.text)}),[A,e]);(0,n.useEffect)((()=>{let e=!0;if(e&&!le&&j&&"loaded"!==w&&!E&&!P&&!T.errorCode)return N(!0),k({endpoint:v}).then((({type:t,payload:s})=>{if(e)if("fetchUsageCount/success"===t)N(!1);else if("fetchUsageCount/error"===t){const{errorMessage:e}=s;"CONSENT_REVOKED"===e&&F(!0)}})),()=>{e=!1,N(!1)}}),[k,j,w,E]);const ue=!j&&I&&O&&"loaded"!==w&&!Y,ce=(0,n.useCallback)((()=>{F(!1),j||f(p)}),[F,j]),de=(0,n.useCallback)((()=>{N(!1),F(!1)}),[F]),me=(0,n.useMemo)((()=>!I),[I]);(0,n.useEffect)((()=>{me&&(W(!0),C())}),[me,C,W]);const pe=me&&"loaded"!==w&&!Y,ye=(0,n.useMemo)((()=>U&&j&&"loaded"!==w),[U,j,w]),he=(0,n.useCallback)((()=>{D(!1),W(!1),_()}),[D,_]),ge=(0,n.useCallback)((()=>{ae(),he()}),[ae,he]);(0,n.useEffect)((()=>{if(!ie||"loaded"!==w)return;const e=ie.innerBlocks.map((e=>{const t=e.attributes.content;return"string"==typeof t?t:t.text})).filter((e=>e&&""!==e));if(R.length){if(!(0,t.isEqual)(e,R))if(oe.current){const e=R.map((e=>(0,s.createBlock)("core/list-item",{content:e})));x(ie.clientId,e,!1),oe.current=!1}else S(e)}else e.length&&S(e)}),[w,R,ne,S]);const be=(0,n.useMemo)((()=>le||"loaded"===w&&!z&&(!me&&j||R.length>0)),[le,w,z,me,j,R.length]),we=(0,n.useCallback)((e=>c({level:e})),[c]),ke=(0,n.useCallback)((()=>{Q&&$(!0)}),[Q]),fe=(0,n.useCallback)((()=>{$(!1)}),[]);return(0,G.jsxs)(G.Fragment,{children:["loaded"===w&&!z&&(0,G.jsx)(r.BlockControls,{children:(0,G.jsxs)(o.ToolbarGroup,{children:[(0,G.jsxs)("div",{onMouseEnter:ke,onMouseLeave:fe,children:[J&&(0,G.jsx)("div",{className:"yst-root yst-relative",children:(0,G.jsx)(u.Tooltip,{children:B})}),(0,G.jsx)(o.ToolbarButton,{icon:"update",label:"Regenerate summary",onClick:ae,disabled:z||Q||!j||!I,children:(0,i.__)("Regenerate summary","wordpress-seo-premium")})]}),(0,G.jsx)(r.HeadingLevelDropdown,{value:b,options:[1,2,3,4,5,6],onChange:we})]})}),(0,G.jsx)(r.InspectorControls,{children:(0,G.jsx)(o.PanelBody,{title:(0,i.__)("About this block","wordpress-seo-premium"),className:"yoast-ai-summarize-controls",children:(0,G.jsx)("p",{children:(0,i.__)("Create a concise summary of your post, highlighting the key takeaways for your readers.","wordpress-seo-premium")})})}),(0,G.jsxs)("div",{...ee,children:[be&&(0,G.jsx)(V,{level:b,title:y,setAttributes:c}),"loaded"!==w&&(0,G.jsx)(H,{loading:z,onGenerate:ae,isUsageCountLoading:P}),(0,G.jsx)(l.ErrorModal,{title:(0,i.__)("AI Summary","wordpress-seo-premium"),badgeText:(0,i.__)("Beta","wordpress-seo-premium"),isOpen:ye,onClose:he,aiModalHelperLink:M,children:(0,G.jsx)(se,{errorCode:L.code,errorIdentifier:L.errorIdentifier,invalidSubscriptions:L.missingLicenses,showActions:!0,onRetry:ge,errorMessage:L.message})}),pe&&(0,G.jsx)(Z,{isFeatureErrorModalOpen:K,aiModalHelperLink:M,onClose:he}),ue&&(0,G.jsx)(te,{shouldOpen:O,handleStartGenerating:de,initialFocus:X,handleClose:ce})]})]})},save({attributes:e}){const{title:t,level:s,status:o}=e;if("loaded"!==o)return null;const a=r.useBlockProps.save({className:"yoast-ai-summarize"});return(0,G.jsxs)("div",{...a,children:[(0,G.jsx)(r.RichText.Content,{tagName:`h${s}`,value:t||(0,i.__)("Key Takeaways","wordpress-seo-premium")}),(0,G.jsx)(r.InnerBlocks.Content,{})]})}})})();