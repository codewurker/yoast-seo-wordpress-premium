(()=>{var e={951:(e,t)=>{var s;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var s=arguments[t];if(s){var r=typeof s;if("string"===r||"number"===r)e.push(s);else if(Array.isArray(s)){if(s.length){var i=o.apply(null,s);i&&e.push(i)}}else if("object"===r){if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]")){e.push(s.toString());continue}for(var a in s)n.call(s,a)&&s[a]&&e.push(a)}}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(s=function(){return o}.apply(t,[]))||(e.exports=s)}()}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.React,t=window.wp.data,n=window.wp.domReady;var o=s.n(n);const r=window.wp.element,i=window.wp.hooks,a=window.yoast.uiLibrary,l=window.lodash,c=window.wp.i18n,d="loading",u="success",p="error",m="error",g="fullContent",h={keyphraseDensityAIFixes:{title:(0,c.__)("AI - Keyphrase density","wordpress-seo-premium"),description:(0,c.__)("Use keyphrase words in the text frequently but not excessively.","wordpress-seo-premium"),parameterName:"seo-keyphrase-density",storeName:"keyphraseDensity",promptContent:g},introductionKeywordAIFixes:{title:(0,c.__)("AI - Keyphrase in introduction","wordpress-seo-premium"),description:(0,c.__)("Include words from the keyphrase in the first paragraph of the text.","wordpress-seo-premium"),parameterName:"seo-keyphrase-introduction",storeName:"keyphraseIntroduction",promptContent:"introduction"},keyphraseDistributionAIFixes:{title:(0,c.__)("AI - Keyphrase distribution","wordpress-seo-premium"),description:(0,c.__)("Evenly distribute keyphrase words throughout the text.","wordpress-seo-premium"),parameterName:"seo-keyphrase-distribution",storeName:"keyphraseDistribution",promptContent:g},subheadingsKeywordAIFixes:{title:(0,c.__)("AI - Keyphrase in subheadings","wordpress-seo-premium"),description:(0,c.__)("Include at least one word from the keyphrase in each subheading.","wordpress-seo-premium"),parameterName:"seo-keyphrase-subheadings",storeName:"keyphraseSubheadings",promptContent:g},textSentenceLengthAIFixes:{title:(0,c.__)("AI - Sentence length","wordpress-seo-premium"),description:(0,c.__)("Ensure long sentences are shortened or split for better readability.","wordpress-seo-premium"),parameterName:"read-sentence-length",storeName:"sentenceLength",promptContent:"sentenceLength"},textParagraphTooLongAIFixes:{title:(0,c.__)("AI - Paragraph length","wordpress-seo-premium"),description:(0,c.__)("Ensure long paragraphs are shortened or split for better readability.","wordpress-seo-premium"),parameterName:"read-paragraph-length",storeName:"paragraphLength",promptContent:"paragraphLength"}},y="yoast-seo/ai-generator",f="yoast-seo-premium/ai-optimize",w={blockEditor:"Gutenberg",classicEditor:"Classic",elementorEditor:"Elementor"},b="yoast-seo/editor",E="core/block-editor",C=window.yoast.propTypes;var S=s.n(C);const x=window.yoast.aiFrontend;var I=s(951),k=s.n(I);const v=window.yoast.reduxJsToolkit,P=window.wp.apiFetch;var A=s.n(P);const M=window.yoast.analysis,L=(0,l.get)(window,"yoast.editorModules.aiGenerator.helpers.removesLocaleVariantSuffixes",l.noop),_={ja:e=>Math.round(e.length/2),default:e=>Math.round(e.length/4)},F=e=>{const s=(0,t.select)(b).getContentLocale();return(_[s]||_.default)(e)},N=window.wp.dom,T=new DOMParser,q=e=>{const t=T.parseFromString("<body>"+e+"</body>","text/html");let s=!1;return t.querySelectorAll("ins.yst-diff").forEach((e=>{(0,N.unwrap)(e),s=!0})),t.querySelectorAll("del.yst-diff").forEach((e=>{(0,N.remove)(e),s=!0})),s?t.body.innerHTML:e},B=e=>{const t=T.parseFromString("<body>"+e+"</body>","text/html");let s=!1;return t.querySelectorAll("ins.yst-diff").forEach((e=>{(0,N.remove)(e),s=!0})),t.querySelectorAll("ins.yst-paragraph").forEach((e=>{e.textContent=" ",(0,N.unwrap)(e),s=!0})),t.querySelectorAll("del.yst-diff").forEach((e=>{(0,N.unwrap)(e),s=!0})),s?t.body.innerHTML:e};class R{getEditorContent(){throw new Error("Method 'getEditorContent' must be implemented.")}resetEditorContent(e){throw new Error("Method 'resetEditorContent' must be implemented.")}previewSuggestions(e){throw new Error("Method 'previewSuggestions' must be implemented.")}applySuggestions(){throw new Error("Method 'applySuggestions' must be implemented.")}dismissSuggestions(){throw new Error("Method 'dismissSuggestions' must be implemented.")}removeAutosave(){throw new Error("Method 'removeAutosave' must be implemented.")}disableEditingMode(){throw new Error("Method 'disableEditingMode' must be implemented.")}enableEditingMode(){throw new Error("Method 'enableEditingMode' must be implemented.")}closeSidebar(){throw new Error("Method 'closeSidebar' must be implemented.")}getFullScreenClass(){throw new Error("Method 'getFullScreenClass' must be implemented.")}}class O extends R{getEditorContent(){return(0,t.select)(E).getBlocks()}resetEditorContent(e){(0,t.dispatch)("core/editor").resetEditorBlocks(e)}previewSuggestions(e){return oe(e)}applySuggestions(){J()}dismissSuggestions(){Q()}removeAutosave(){(()=>{const{lockPostSaving:e,unlockPostSaving:s}=(0,t.useDispatch)("core/editor");(0,r.useEffect)((()=>(e("ai-optimize"),()=>{s("ai-optimize")})),[])})()}disableEditingMode(){(()=>{const e=(0,t.useSelect)((e=>{const t=e(E).getBlocks(),s=Z(t);return(0,l.unionBy)(t,s,"clientId")}),[]),{setBlockEditingMode:s}=(0,t.useDispatch)(E);(0,r.useEffect)((()=>(e.forEach((e=>s(e.clientId,"disabled"))),()=>re())),[e])})()}enableEditingMode(){re()}closeSidebar(){window.innerWidth<=768&&(0,t.dispatch)("core/edit-post").closeGeneralSidebar()}getFullScreenClass(){return(0,t.useSelect)((e=>e("core/preferences").get("core/edit-post","fullscreenMode")?"":"lg:yst-start-44"),[])}}const D=window.wp.blocks;class U{getIntroductionText(e){throw new Error("Method 'getIntroductionText()' must be implemented.")}getFullText(){throw new Error("Method 'getFullText()' must be implemented.")}getParagraphLengthPromptContent(){throw new Error("Method 'getParagraphLengthPromptContent()' must be implemented.")}getSentenceLengthPromptContent(){throw new Error("Method 'getSentenceLengthPromptContent()' must be implemented.")}shouldRetrievePromptContent(){throw new Error("Method 'shouldRetrievePromptContent()' must be implemented.")}}class z extends U{constructor(){super(),this.getSentenceLengthPromptContent=this.getSentenceLengthPromptContent.bind(this),this.getParagraphLengthPromptContent=this.getParagraphLengthPromptContent.bind(this),this.getFullText=this.getFullText.bind(this),this.getIntroductionText=this.getIntroductionText.bind(this),this.cleanUpContent=this.cleanUpContent.bind(this),this.getRelevantPromptContent=this.getRelevantPromptContent.bind(this),this.shouldRetrievePromptContent=this.shouldRetrievePromptContent.bind(this)}cleanUpContent(e,t=(e=>e)){return(e=t(e=B(e))).replace(/\n/g,"")}async getIntroductionText(e){const s=(0,l.get)(window,"YoastSEO.analysis.worker.runResearch",l.noop),{result:n}=await s("findKeywordInFirstParagraph",e);if(!n)return{text:"",length:0,type:"introduction",uniqueIds:[]};const o=n.introduction,r=n.parentBlock;if(!o||!r)return{text:"",length:0,type:"introduction",uniqueIds:[]};if("core/freeform"===r.name){const{startOffset:e,endOffset:t}=o.sourceCodeLocation,s=this.cleanUpContent(r.attributes.content,(s=>s.slice(e-r.startOffset,t-r.startOffset)));return{text:s,length:F(s),type:"introduction",uniqueIds:[]}}const{getBlocksByClientId:i}=(0,t.select)(E),a=i(o.clientId);if(!a[0])return{text:"",length:0,type:"introduction",uniqueIds:[]};const c=Z(a),d=this.cleanUpContent((0,D.serialize)(c,{isInnerBlocks:!1}));return{text:d,length:F(d),type:"introduction",uniqueIds:c.map((e=>e.clientId))}}getFullText(){const{getBlocks:e}=(0,t.select)(E),s=Z(e()),n=(0,D.serialize)(s,{isInnerBlocks:!1}),o=this.cleanUpContent(n);return{text:o,length:F(o),type:"fullContent",uniqueIds:s.map((e=>e.clientId))}}getRelevantPromptContent(e,s){if(!e||!e._hasMarks)return{text:"",length:0,type:s,uniqueIds:[]};const n=e.marks,o=new Set(n.map((e=>e._properties.position&&e._properties.position.clientId))),{getBlocksByClientId:r}=(0,t.select)(E),i=[];if(o.forEach((e=>{const[t]=r(e);e&&t&&i.push(t)})),!i.length)return{text:"",length:0,type:s,uniqueIds:[]};let a=[];a="paragraphLength"===s?Z(i,["core/paragraph","core/heading","core/list-item"]):Z(i);const l=a.map((e=>e.clientId)),c=(0,D.serialize)(a,{isInnerBlocks:!1}),d=this.cleanUpContent(c);return{text:d,length:F(d),type:s,uniqueIds:l}}getParagraphLengthPromptContent(){const e=(0,t.select)(b).getReadabilityResults().results.find((e=>"textParagraphTooLong"===e._identifier));return this.getRelevantPromptContent(e,"paragraphLength")}getSentenceLengthPromptContent(){const e=(0,t.select)(b).getReadabilityResults().results.find((e=>"textSentenceLength"===e._identifier));return this.getRelevantPromptContent(e,"sentenceLength")}shouldRetrievePromptContent(){return!0}}new DOMParser;class V{constructor(e){if(this._strategy=null,"blockEditor"!==e)throw new Error("Unsupported editor");this._strategy=new z,this.getSentenceLengthPromptContent=this.getSentenceLengthPromptContent.bind(this),this.getParagraphLengthPromptContent=this.getParagraphLengthPromptContent.bind(this),this.getFullText=this.getFullText.bind(this),this.getIntroductionText=this.getIntroductionText.bind(this),this.shouldRetrievePromptContent=this.shouldRetrievePromptContent.bind(this)}getIntroductionText(e){if(!this._strategy)throw new Error("Strategy not available");if(!this._strategy.getIntroductionText)throw new Error("Method 'getIntroductionText()' not implemented");return this._strategy.getIntroductionText(e)}getFullText(){if(!this._strategy)throw new Error("Strategy not available");if(!this._strategy.getFullText)throw new Error("Method 'getFullText()' not implemented");return this._strategy.getFullText()}getParagraphLengthPromptContent(){if(!this._strategy)throw new Error("Strategy not available");if(!this._strategy.getParagraphLengthPromptContent)throw new Error("Method 'getParagraphLengthPromptContent()' not implemented");return this._strategy.getParagraphLengthPromptContent()}getSentenceLengthPromptContent(){if(!this._strategy)throw new Error("Strategy not available");if(!this._strategy.getSentenceLengthPromptContent)throw new Error("Method 'getSentenceLengthPromptContent()' not implemented");return this._strategy.getSentenceLengthPromptContent()}shouldRetrievePromptContent(){if(!this._strategy)throw new Error("Strategy not available");if(!this._strategy.shouldRetrievePromptContent)throw new Error("Method 'shouldRetrievePromptContent()' not implemented");return this._strategy.shouldRetrievePromptContent()}}const K=window.wp.htmlEntities,G=(e,s)=>{const n=(0,t.select)(E).getBlockRootClientId(e);n&&(0,t.dispatch)(E).setBlockEditingMode(n,s)},j=new DOMParser,Y=()=>{const e=(0,t.select)(b).getActiveAIFixesButton(),{selectUniqueIds:s}=(0,t.select)(f),{getBlocks:n,getBlocksByClientId:o}=(0,t.select)(E);if(!e){const e=n();return{storeName:"",blockIds:e.map((e=>e.clientId)),blocks:e}}const r=h[e].promptContent,i=s(r);return{storeName:r,blockIds:i,blocks:o(i)}},H=e=>{const{updateUniqueIds:s}=(0,t.dispatch)(f),{replaceBlock:n}=(0,t.dispatch)(E),{storeName:o,blockIds:r,blocks:i}=Y();let a=r;i.forEach((t=>{const s=(0,D.serialize)([t],{isInnerBlocks:!1}),o=(0,K.decodeEntities)(e(s));if(s!==o){const e=(0,D.parse)(o,{})[0];G(t.clientId,"default"),n(t.clientId,e),a=a.toSpliced(a.indexOf(t.clientId),1,e.clientId)}})),o&&s({promptContentType:o,uniqueIds:a})},W=e=>{const t=j.parseFromString("<body>"+e+"</body>","text/html");let s=!1;for(;t.querySelector("ins.yst-paragraph");){const e=t.querySelector("ins.yst-paragraph"),n=t.createTreeWalker(t.body,NodeFilter.SHOW_COMMENT),o=n.nextNode().cloneNode(!1);let r=null;for(;n.nextNode();)r=n.currentNode;const i=r.cloneNode(!1);let a=e.parentNode.cloneNode(!1);const l=[];e.parentNode.childNodes.forEach((t=>{t===e?(l.push(a),l.push(i),l.push(o),a=e.parentNode.cloneNode(!1)):a.appendChild(t.cloneNode(!0))})),l.push(a),e.parentNode.replaceWith(...l),s=!0}return s?t.body.innerHTML:e},Q=()=>{const e=(0,l.get)(window,"YoastSEO.app.refresh",l.noop);H(B),e()},J=()=>{const e=(0,l.get)(window,"YoastSEO.app.refresh",l.noop);H(q);const s=(0,t.select)(b).getActiveAIFixesButton();s&&"textParagraphTooLongAIFixes"===s&&(()=>{const{storeName:e,blockIds:s,blocks:n}=Y(),{replaceBlock:o}=(0,t.dispatch)(E),{updateUniqueIds:r}=(0,t.dispatch)(f);let i=s;n.forEach((e=>{const t=(0,D.serialize)([e],{isInnerBlocks:!1});if(!t.includes('<ins class="yst-paragraph">'))return;const s=W(t),n=(0,D.parse)(s,{});o(e.clientId,n);const r=n.map((e=>e.clientId));i=i.toSpliced(i.indexOf(e.clientId),1,...r)})),e&&r({promptContentType:e,uniqueIds:i})})(),e()},$=["core/paragraph","core/heading","core/list-item","core/table"],X=["core/quote","core/cover"],Z=(e,t=$)=>e.reduce(((e,s)=>X.includes(s.name)||(e=>{var t;return!(t=(0,D.getBlockContent)(e),(new DOMParser).parseFromString(t,"text/html").documentElement.textContent).trim()})(s)?e:t.includes(s.name)?[...e,s]:s.innerBlocks.length>0?[...e,...Z(s.innerBlocks,t)]:e),[]),ee=(e,t)=>!(!e||!t||(t.isValid?e.name!==t.name&&(console.error("The type of block from the editor does not match the type of block parsed from the AI suggestion."),1):(console.error("The block parsed from the AI suggestion is not valid."),1))),te=e=>{const t=document.querySelector('[data-block="'+e+'"]');t&&t.scrollIntoView({behavior:"smooth",block:"start"})},se=()=>{(0,i.addFilter)("yoast.analysis.data","yoast-seo-premium/ai-suggestion-analysis-data-modifier",(e=>({...e,text:q(W(e.text))})))},ne=()=>{(0,t.select)(E).getBlocksByName("core/details").forEach((e=>{(0,t.dispatch)(E).updateBlockAttributes(e,{showContent:!0})}))},oe=e=>{const s=(0,t.select)(b).getActiveAIFixesButton(),n=h[s].promptContent;return"introductionKeywordAIFixes"===s?((e,s)=>{const{getBlocksByClientId:n}=(0,t.select)(E),{replaceBlock:o}=(0,t.dispatch)(E),{updateUniqueIds:r}=(0,t.dispatch)(f),i=(0,l.get)(window,"YoastSEO.analysis.worker.runResearch",l.noop),a=(0,l.get)(window,"YoastSEO.analysis.collectData",!1);return i("findKeywordInFirstParagraph",a?M.Paper.parse(a()):null).then((i=>{if(i.result){const a=i.result.introduction,l=i.result.parentBlock;if(!a||!l)return;if("core/freeform"===l.name)((e,s,n)=>{const{updateBlockAttributes:o}=(0,t.dispatch)(E),{startOffset:r,endOffset:i}=e.sourceCodeLocation,a=B(s.attributes.content),l=a.slice(0,r-s.startOffset)+n+a.slice(i-s.startOffset),c=s.clientId;G(c,"default"),o(c,{content:l}),G(c,"disabled"),te(c),se()})(a,l,e),r({promptContentType:s,uniqueIds:[l.clientId]});else{const t=a.clientId,i=n(t),l=Z(i)[0],c=(0,D.parse)(e,{})[0];if(!ee(l,c))throw new Error("Error");{const{clientId:e}=l;G(e,"default"),o(e,c),G(c.clientId,"disabled"),ne(),te(e),se(),r({promptContentType:s,uniqueIds:[c.clientId]})}}}}))})(e,n):function(e,s){const{replaceBlock:n}=(0,t.dispatch)(E),{updateUniqueIds:o}=(0,t.dispatch)(f),{getBlocksByClientId:r}=(0,t.select)(E),i=r((0,t.select)(f).selectUniqueIds(s)),a=(0,D.parse)(e,{});return new Promise(((e,t)=>{if(i.length===a.length){const r=(0,l.zip)(i,a);if(r.every((([e,t])=>ee(e,t)))){const t=[];r.forEach((([e,s])=>{G(e.clientId,"default"),n(e.clientId,s),G(s.clientId,"disabled"),ne(),t.push(s.clientId)}));const i=r.find((([e,t])=>e.originalContent!==t.originalContent));te(i[0].clientId),se(),o({promptContentType:s,uniqueIds:t}),e()}else t("Error")}else console.error("The number of blocks in the editor and the number of blocks parsed from the AI suggestion do not match."),t("Error")}))}(e,n)},re=()=>{const e=(0,t.select)(E).getBlocks,{setBlockEditingMode:s}=(0,t.dispatch)(E),n=e(),o=Z(n);(0,l.unionBy)(n,o,"clientId").forEach((e=>{s(e.clientId,"default")}))},ie=(new DOMParser,(0,l.get)(window,"yoast.editorModules.aiGenerator.helpers.fetchSuggestions",l.noop)),ae=(0,v.createSlice)({name:"fixes",initialState:{status:d,error:{code:200,message:"",errorIdentifier:""},fixes:{keyphraseIntroduction:"",keyphraseDensity:"",keyphraseDistribution:"",keyphraseSubheadings:"",sentenceLength:"",paragraphLength:""}},reducers:{setLoading:e=>{e.status=d},setSuccess:(e,{payload:t})=>{e.status=u,e.fixes=t.data},setError:(e,{payload:t})=>{e.status=p,e.error=t}}}),le=(0,l.get)(window,"yoast.editorModules.aiGenerator.components.SuggestionError",l.noop),ce=(0,l.get)(window,"yoast.editorModules.aiGenerator.components.SparksLimitNotification",l.noop),de=({assessmentName:s,getEditorContent:n,resetEditorContent:o,previewSuggestions:i,applySuggestions:l,dismissSuggestions:g,removeAutosave:w,disableEditingMode:E,enableEditingMode:C,closeSidebar:S,getFullScreenClass:I})=>{const{areFixesApplied:v,isNotificationVisible:P,counts:A,limit:_}=(0,t.useSelect)((e=>({areFixesApplied:e(f).areFixesApplied(),isNotificationVisible:e(f).isNotificationVisible(),counts:e(y).selectUsageCount(),limit:e(y).selectUsageCountLimit()})),[]),{learnMoreLink:F,helperLink:N}=(0,t.useSelect)((e=>({learnMoreLink:e(b).selectLink("https://yoa.st/ai-fix-assessments-toast-learn-more"),helperLink:e(b).selectLink("https://yoa.st/ai-fix-assessments-help-button")})),[]),{setAreFixesApplied:T,setIsNotificationVisible:q}=(0,t.useDispatch)(f),{setActiveAIFixesButton:B,setMarkerStatus:R}=(0,t.useDispatch)(b),[O,D]=(0,r.useState)(""),[U,z]=(0,r.useState)(null),V=(0,r.useRef)(null),{position:K}=(0,a.useNotificationsContext)(),{fixes:G,fetchFixes:j}=(()=>{const{fetchUsageCount:e}=(0,t.useDispatch)(y),[s,n]=(0,r.useReducer)(ae.reducer,ae.getInitialState()),{synonyms:o,focusKeyphrase:i,promptContentData:a,contentLocale:l,usageCountEndpoint:c}=(0,t.useSelect)((e=>({focusKeyphrase:e(b).getFocusKeyphrase(),synonyms:e("yoast-seo-premium/editor").getSynonyms(),promptContentData:e(f).selectPromptContentFixAssessments(),contentLocale:e(b).getContentLocale(),usageCountEndpoint:e(y).selectUsageCountEndpoint()})),[]),d=(0,r.useCallback)((async(t,s=!0)=>{n(ae.actions.setLoading());const r=((e,t,s,n,o)=>{let r=M.languageProcessing.helpers.processExactMatchRequest(s).keyphrase;r.length>191&&(r=r.slice(0,191));const i=h[t].parameterName,a=e[h[t].promptContent].text;return{focus_keyphrase:r,synonyms:n,language:L(o).replace("_","-"),prompt_content:a,assessment:i}})(a,t,i,o,l),{status:d,payload:u}=await ie({endpoint:"yoast/v1/ai/optimize/",canAbort:s,data:r});switch(d){case"abort":break;case m:n(ae.actions.setError(u));break;case"success":u?(n(ae.actions.setSuccess({assessment:h[t].storeName,data:u})),e({endpoint:c})):n(ae.actions.setError(u))}return d}),[n]);return{fixes:s,fetchFixes:d}})(),Y=I(),H=(0,r.useMemo)((()=>O===m||G.status===p),[O,G.status]),W=(0,r.useCallback)((()=>{D(""),j(s).then((e=>{D(e)}))}),[]),Q=(0,r.useCallback)((()=>{o(U),setTimeout((()=>B(null)),150)}),[B,U]),J=(0,r.useCallback)((()=>{B(null),D("")}),[B]),$=(0,r.useCallback)((()=>{o(U),setTimeout((()=>B(null)),150),q(!1),T(!1)}),[q,B,T,U]),X=(0,r.useCallback)((()=>{q(!1),D(""),l(),T(!0),setTimeout((()=>{B(null),T(!1)}),5e3)}),[q,B,T,l]),Z=(0,r.useCallback)((()=>{C(),T(!1),q(!1)}),[T,q]);return(0,r.useEffect)((()=>(j(s).then((e=>{D(e)})),()=>{g(),D("")})),[D,j,g]),(0,r.useEffect)((()=>{G.status===u&&G.fixes&&""!==O&&(null===U&&z(n()),i(G.fixes).catch((()=>{D(m)})))}),[G,O]),w(),E(),(0,r.useEffect)((()=>(P&&R("disabled"),()=>R("enabled"))),[P,R]),(0,r.useEffect)((()=>{const e=document.getElementById("adminmenuwrap");return P&&e?(null===V.current&&(V.current=e.style.zIndex),e.style.zIndex="10"):!P&&e&&null!==V.current&&(e.style.zIndex=V.current,V.current=null),()=>{e&&null!==V.current&&(e.style.zIndex=V.current,V.current=null)}}),[P]),S(),(0,e.createElement)(r.Fragment,null,(0,e.createElement)(x.ErrorModal,{title:h[s].title,badgeText:(0,c.__)("Beta","wordpress-seo-premium"),isOpen:H,onClose:J,aiModalHelperLink:N},(0,e.createElement)(le,{errorCode:G.error.code,errorIdentifier:G.error.errorIdentifier,invalidSubscriptions:G.error.missingLicenses,showActions:!0,onRetry:W,errorMessage:G.error.message})),(0,e.createElement)(a.Notifications,{className:k()("yst-mx-[calc(50%-50vw)] yst-transition-all",Y),position:"bottom-left"},G.status!==d&&(0,e.createElement)(ce,{className:`yst-mb-30 yst-w-96 ${Y}`,size:"large"}),G.status!==p&&!H&&(0,e.createElement)(a.Toast,{id:s,className:"yst-w-96 yst-bg-gradient-to-br yst-from-primary-50 yst-to-indigo-50 yst-border-gradient yst-overflow-y-visible",onDismiss:Q,isVisible:P,setIsVisible:q,position:K},G.status===d&&(0,e.createElement)(r.Fragment,null,(0,e.createElement)(x.UsageCounter,{className:"yst-absolute yst-w-[65px] yst-h-[18px] yst-top-[-8px] yst-start-[245px] sm:yst-start-[280px]",limit:_,requests:A,isSkeleton:!0}),(0,e.createElement)(x.ToastSkeleton,null)),G.status===u&&(0,e.createElement)(r.Fragment,null,(0,e.createElement)(x.UsageCounter,{className:"yst-absolute yst-top-[-10px] yst-end-9",limit:_,requests:A,isSkeleton:!1}),(0,e.createElement)(x.ToastContent,{title:h[s].title,description:h[s].description,badgeText:"Beta",learnMoreLink:F,handleDismiss:$,handleApply:X}))),v&&(0,e.createElement)(a.Notifications.Notification,{id:"applied-success-notification",variant:"success",size:"large",dismissScreenReaderLabel:(0,c.__)("Dismiss","wordpress-seo-premium"),autoDismiss:6e3,onDismiss:Z,className:"yst-border-slate-200"},(0,e.createElement)("div",{className:"yst-flex yst-items-start yst-justify-between"},(0,e.createElement)("p",{className:"yst-font-medium yst-text-slate-800"}," ",(0,c.__)("Successfully applied!","wordpress-seo-premium")),(0,e.createElement)(a.Button,{type:"button",variant:"tertiary",className:"yst-text-primary-500 yst-py-0",onClick:$},(0,c.__)("Undo","wordpress-seo-premium"))))))};de.propTypes={assessmentName:S().string.isRequired,getEditorContent:S().func.isRequired,resetEditorContent:S().func.isRequired,previewSuggestions:S().func.isRequired,applySuggestions:S().func.isRequired,dismissSuggestions:S().func.isRequired,removeAutosave:S().func.isRequired,disableEditingMode:S().func.isRequired,enableEditingMode:S().func.isRequired,closeSidebar:S().func.isRequired,getFullScreenClass:S().func.isRequired};const ue=(0,l.get)(window,"yoast.editorModules.aiGenerator.components.Introduction",l.noop),pe=(0,l.get)(window,"yoast.editorModules.aiGenerator.components.FeatureError",l.noop),me=({assessmentName:s,editor:n})=>{const{initialConsent:o,currentSubscriptions:i,hasValidPremiumSubscription:l}=(0,t.useSelect)((e=>({initialConsent:e(y).selectHasAiGeneratorConsent(),currentSubscriptions:e(y).selectProductSubscriptions(),hasValidPremiumSubscription:e(y).selectPremiumSubscription()})),[]),{aiModalHelperLink:d,isSeoAnalysisActive:u,activeAIOptimizeButton:p}=(0,t.useSelect)((e=>({isSeoAnalysisActive:e(b).getPreference("isKeywordAnalysisActive",!0),activeAIOptimizeButton:e(b).getActiveAIFixesButton(),aiModalHelperLink:e(b).selectLink("https://yoa.st/ai-fix-assessments-help-button")})),[]),m=!l||!u,g=p===s,{setActiveAIFixesButton:f}=(0,t.useDispatch)(b),[w,E]=(0,r.useState)(o),C=(0,r.useCallback)((()=>{f(null)}),[f]),S=(0,r.useCallback)((()=>{E(!0),f(s)}),[E,f,s]),I=(0,r.useRef)(null),k=(0,c.__)("Close modal","wordpress-seo-premium"),v=(0,r.useMemo)((()=>{if("Gutenberg"===n)return new O;throw new Error("Unsupported editor")}),[n]);return g&&(0,e.createElement)(r.Fragment,null,w&&!m&&(0,e.createElement)(de,{assessmentName:s,getEditorContent:v.getEditorContent,resetEditorContent:v.resetEditorContent,previewSuggestions:v.previewSuggestions,applySuggestions:v.applySuggestions,dismissSuggestions:v.dismissSuggestions,removeAutosave:v.removeAutosave,disableEditingMode:v.disableEditingMode,enableEditingMode:v.enableEditingMode,closeSidebar:v.closeSidebar,getFullScreenClass:v.getFullScreenClass}),(0,e.createElement)(x.ErrorModal,{title:h[s].title,isOpen:m,onClose:C,badgeText:(0,c.__)("Beta","wordpress-seo-premium"),aiModalHelperLink:d},(0,e.createElement)(pe,{currentSubscriptions:i,isSeoAnalysisActive:u})),(0,e.createElement)(a.Modal,{className:"yst-introduction-modal",isOpen:!w&&l&&!m,onClose:C,initialFocus:I},(0,e.createElement)(a.Modal.Panel,{className:"yst-max-w-lg yst-p-0 yst-rounded-3xl",closeButtonScreenReaderText:k},(0,e.createElement)(ue,{onStartGenerating:S}))))};me.propTypes={assessmentName:S().string.isRequired,editor:S().string.isRequired};const ge="aiOptimizeNotificationStatus",he=(0,v.createSlice)({name:ge,initialState:!1,reducers:{setIsNotificationVisible:(e,{payload:t})=>t}}),ye=he.getInitialState,fe={isNotificationVisible:e=>(0,l.get)(e,ge,"")},we=he.actions,be=he.reducer,Ee="appliedFixesStatus",Ce=(0,v.createSlice)({name:Ee,initialState:!1,reducers:{setAreFixesApplied:(e,{payload:t})=>t}}),Se=Ce.getInitialState,xe={areFixesApplied:e=>(0,l.get)(e,Ee,"")},Ie=Ce.actions,ke=Ce.reducer,ve="promptContentFixAssessments",Pe=(0,v.createSlice)({name:ve,initialState:{introduction:{text:"",length:0,uniqueIds:[]},fullContent:{text:"",length:0,uniqueIds:[]},sentenceLength:{text:"",length:0,uniqueIds:[]},paragraphLength:{text:"",length:0,uniqueIds:[]}},reducers:{setPromptContentFixAssessments:(e,{payload:t})=>t,updateUniqueIds:(e,{payload:t})=>{const{promptContentType:s,uniqueIds:n}=t;e[s].uniqueIds=n}}}),Ae=Pe.getInitialState,Me={selectPromptContentFixAssessments:e=>(0,l.get)(e,ve,""),selectUniqueIds:(e,t)=>(0,l.get)(e,[ve,t,"uniqueIds"],[])},Le=Pe.actions,_e=Pe.reducer;let Fe=!1,Ne=null;const Te=e=>{const{setPromptContentFixAssessments:s}=(0,t.dispatch)(f),{isNotificationVisible:n}=(0,t.select)(f),o=[e.getFullText,e.getIntroductionText,e.getParagraphLengthPromptContent,e.getSentenceLengthPromptContent];return()=>{const r=(0,l.get)(window,"YoastSEO.analysis.collectData",!1),i=n();se();const a=e.shouldRetrievePromptContent();(async(e,s,n,o,r)=>{const i=n?M.Paper.parse(n()):null;if(!((e,t,s,n)=>!(!e||t||!s.length||!n))(i,e,o,r))return;const a={},l=[],d=(await Promise.all(o.map((async e=>{try{return await e(i)}catch(e){return console.error("Error retrieving relevant content:",e),null}})))).filter((e=>null!==e));0!==d.length&&(d.forEach((({text:e,length:t,type:s,uniqueIds:n})=>{a[s]={text:e,length:t,uniqueIds:n},l.push({length:t,type:s})})),(e=>{const s={};e.forEach((({length:e,type:t})=>{(0===e||e>2e3)&&Object.keys(h).filter((e=>h[e].promptContent===t)).forEach((t=>{s[t]=(e=>{const t=(0,c.__)("None of the elements in your content is supported by Yoast AI Optimize. This means you cannot use this feature with your current content.","wordpress-seo-premium"),s=(0,c.__)("Your text is too long for the AI model to process.","wordpress-seo-premium");return 0===e?t:s})(e)}))}));const{setDisabledAIFixesButtons:n}=(0,t.dispatch)(b);n(s)})(l),s(a))})(i,s,r,o,a)}},qe=s=>{Fe||(Fe=!0,"1"!==(0,l.get)(window,"wpseoPremiumAiOptimize.hasSeenIntroduction",!1)&&(()=>{try{A()({path:"yoast/v1/introductions/ai-fix-assessments/seen/",method:"POST"})}catch(e){}})());const n=(0,l.get)(window,"wpseoScriptData.metabox.isRtl",!1),o=(0,t.select)(b).getEditorType(),r=w[o];Ne.render((0,e.createElement)(a.Root,{context:{isRtl:n}},(0,e.createElement)(me,{assessmentName:s,editor:r})))},Be=()=>{"classicEditor"===(0,t.select)(b).getEditorType()&&(()=>{const e=document.querySelector("#post");e&&e.addEventListener("submit",(function(){jQuery("#content-tmce").click(),tinyMCE.init({selector:"#content"});const e=tinyMCE.get("content"),t=null==e?void 0:e.dom,s=null==t?void 0:t.select("p, h1, h2, h3, h4, h5, h6, li"),n=/\bai-optimize-[^\s]*\b/gi;null==s||s.forEach((e=>{const s=(t.getAttrib(e,"class")||"").replace(n,"").trim();t.setAttrib(e,"class",s)})),null==e||e.save()}))})()};o()((()=>{const e=document.getElementById("yoast-seo-premium-ai-optimize");e&&(Ne=(0,r.createRoot)(e),((e={})=>{(0,t.register)((e=>(0,t.createReduxStore)(f,{actions:{...Le,...Ie,...we},selectors:{...Me,...xe,...fe},initialState:(0,l.merge)({},{[ve]:Ae(),[Ee]:Se(),[ge]:ye()},e),reducer:(0,t.combineReducers)({[ve]:_e,[Ee]:ke,[ge]:be})}))(e))})(),(0,i.addAction)("yoast.ai.fixAssessments","yoast/yoast-seo-premium/AiFixAssessments",qe),setTimeout(Be,100))})),window.jQuery(window).on("YoastSEO:ready",(()=>{const e=(0,t.select)(b).getEditorType();(0,t.select)("core/block-editor")&&"blockEditor"===e&&(e=>{const s=new V(e);Te(s),(0,t.subscribe)((0,l.debounce)((e=>{const{getEditorDataContent:s,getReadabilityResults:n}=(0,t.select)(b),{areFixesApplied:o,isNotificationVisible:r}=(0,t.select)(f),i=(0,l.get)(window,"yoast.editorModules.helpers.createWatcher",l.noop),a=((...e)=>()=>e.map((e=>e())))(o,s,(0,l.get)(window,"YoastSEO.analysis.collectData",!1),n,r,(()=>"undefined"!=typeof tinyMCE&&tinyMCE.get("content"))),c=Te(e);return setTimeout(c,1500),i(a,c)})(s),1500,{maxWait:3e3}))})("blockEditor")}))})()})();