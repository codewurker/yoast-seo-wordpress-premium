(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.apiFetch;var r=e.n(t);const i=[410,451];const o=function(e){this.form=e};o.prototype.getOriginField=function(){return this.form.find("input[name=wpseo_redirects_origin]")},o.prototype.getTargetField=function(){return this.form.find("input[name=wpseo_redirects_target]")},o.prototype.getTypeField=function(){return this.form.find("select[name=wpseo_redirects_type]")},o.prototype.clearErrorMessage=function(){this.form.find(".wpseo_redirect_form .form_error").remove()},o.prototype.setErrorMessage=function(e){this.form.find(".wpseo_redirect_form").prepend('<div class="form_error error"><p>'+e+"</p></div>")},o.prototype.removeRowHighlights=function(){this.form.find(".redirect_form_row").removeClass("field_error")},o.prototype.highLightRowErrors=function(e){for(let t=0;t<e.length;t++)switch(e[t]){case"origin":this.highlightRow(this.getOriginField());break;case"target":this.highlightRow(this.getTargetField());break;case"type":this.highlightRow(this.getTypeField())}},o.prototype.highlightRow=function(e){jQuery(e).closest("div.redirect_form_row").addClass("field_error")};const n=o,s=function(e,t){this.form=e,this.type=t,this.validationError=""};s.prototype.validate=function(){return this.form.clearErrorMessage(),this.form.removeRowHighlights(),!1!==this.runValidation(this.form.getOriginField(),this.form.getTargetField(),this.form.getTypeField())||(this.addValidationError(this.validationError),!1)},s.prototype.runValidation=function(e,t,r){if(""===e.val())return this.form.highlightRow(e),"plain"===this.type?this.setError(wpseoPremiumStrings.error_old_url):this.setError(wpseoPremiumStrings.error_regex);if(-1===jQuery.inArray(parseInt(r.val(),10),i)){if(""===t.val())return this.form.highlightRow(t),this.setError(wpseoPremiumStrings.error_new_url);if(t.val()===e.val())return this.form.highlightRow(t),this.setError(wpseoPremiumStrings.error_circular)}return""!==r.val()||(this.form.highlightRow(r),this.setError(wpseoPremiumStrings.error_new_type))},s.prototype.setError=function(e){return this.validationError=e,!1},s.prototype.addValidationError=function(e,t=null){this.form.setErrorMessage(e),void 0!==t&&this.form.highLightRowErrors(t)},s.prototype.getFormValues=function(){const e={origin:this.form.getOriginField().val().toString(),target:this.form.getTargetField().val().toString(),type:this.form.getTypeField().val().toString()};return jQuery.inArray(parseInt(e.type,10),i)>-1&&(e.target=""),e};const a=s,d=function(){this.row=null,this.quickEditRow=null,this.templateQuickEdit=wp.template("redirects-inline-edit")};d.prototype.setup=function(e,t){this.row=e,this.quickEditRow=jQuery(this.templateQuickEdit({origin:_.unescape(t.origin.html()),target:_.unescape(t.target.html()),type:parseInt(t.type.html(),10),suffix:jQuery("#the-list").find("tr").index(e)}))},d.prototype.getRow=function(){return this.row},d.prototype.getForm=function(){return this.quickEditRow},d.prototype.show=function(){this.row.addClass("hidden"),this.quickEditRow.insertAfter(this.row).show(400,(function(){jQuery(this).find(":input").first().trigger("focus")}))},d.prototype.remove=function(){this.row.removeClass("hidden"),this.quickEditRow.remove()};const l=d;!function(e){const t=window.wpseoAdminRedirect.homeUrl||"",o=function(e){return e&&"/"===e.charAt(0)?e.slice(1):e},s=new l;e.widget("ui.dialog",e.ui.dialog,{_createOverlay:function(){this._super(),this.options.modal&&this._on(this.overlay,{click:function(e){this.close(e)}})}}),e.fn.wpseoRedirects=function(d){const l=this,c=d.replace("table-","");let p,u=!1,h=null;const g=function(){u=!1,p=null},f=(e,t=null)=>{const{buttonValue:r,className:i="button"}=e;return{text:r,class:i,click:function(){null!==t&&t(),jQuery(this).dialog("close")}}};this.getButtons=function(e){return"default"===e?[f({buttonValue:wpseoPremiumStrings.button_ok})]:[f({buttonValue:wpseoPremiumStrings.button_cancel},(()=>{g()})),f({buttonValue:wpseoPremiumStrings.button_save_anyway,className:"button-primary"},(()=>{u=!0,p(),g()}))]},this.rowCells=function(e){const t=e.find(".val");return{origin:t.eq(1),target:t.eq(2),type:t.eq(0)}},this.dialog=function(t,r,i){void 0!==i&&"error"!==i||(i="default");const o=this.getButtons(i);e("#YoastRedirectDialogText").html(r),e("#YoastRedirectDialog").dialog({title:t,width:500,draggable:!1,resizable:!1,position:{at:"center center",my:"center center",of:window},buttons:o,modal:!0,close:function(){h&&h.trigger("focus")}})},this.openDialog=function(e){this.dialog(e.title,e.message)},this.post=function(t,r){e.post(ajaxurl,t,r,"json")},this.editRow=function(t){e("#the-list").find("#inline-edit").length>0?this.dialog(wpseoPremiumStrings.edit_redirect,wpseoPremiumStrings.editing_redirect):(s.setup(t,this.rowCells(t)),s.show(),new n(s.quickEditRow).getTypeField().trigger("change"))},this.prepareNewUrl=function(r,i){const n=["val"];if(i.isTargetRelative&&"/"!==r||n.push("remove-slashes"),i.hasTrailingSlash&&n.push("has-trailing-slash"),r){let s=r;return i.isTargetRelative&&(s=t+s),e("<a>").addClass(n.join(" ")).attr({href:_.escape(o(s)),target:"_blank"}).html(_.escape(r))}return e("<div>").addClass("val remove-slashes")},this.createRedirectRow=function(r,i,n,s){const a=e("#the-list tr").length+1;return e("<tr>").append(e("<th>").addClass("check-column").attr("scope","row").append(e("<label>").addClass("screen-reader-text").attr("for","wpseo-redirects-bulk-cb-"+a).html("Select this redirect"),e("<input>").attr("type","checkbox").attr("name","wpseo_redirects_bulk_delete[]").attr("id","wpseo-redirects-bulk-cb-"+a).val(_.escape(r)))).append(e("<td>").addClass("type column-type has-row-actions column-primary").append(e("<div>").addClass("val type").html(_.escape(n))).append(e("<div>").addClass("row-actions").append(e("<span>").addClass("edit").append(e("<a>").attr({href:"#",role:"button",class:"redirect-edit"}).html(wpseoPremiumStrings.editAction)).append(" | ")).append(e("<span>").addClass("trash").append(e("<a>").attr({href:"#",role:"button",class:"redirect-delete"}).html(wpseoPremiumStrings.deleteAction))))).append(e("<td>").addClass("column-old").append("regex"===c?e("<div>").addClass("val remove-slashes").html(_.escape(r)):e("<a>").addClass("val").attr({href:_.escape(t+o(r)),target:"_blank"}).html(_.escape(r)))).append(e("<td>").addClass("column-new").append(this.prepareNewUrl(i,s)))},this.handleError=function(e,t){e.addValidationError(t.message,t.fields),"warning"===t.type&&l.dialog(wpseoPremiumStrings.error_saving_redirect,t.message,t.type)},this.addRedirect=function(){const t=new n(e(".wpseo-new-redirect-form")),r=new a(t,c);if(!1===r.validate())return!1;const i=r.getFormValues();return l.post({action:"wpseo_add_redirect_"+c,ajax_nonce:e(".wpseo_redirects_ajax_nonce").val(),redirect:{origin:encodeURIComponent(i.origin),target:encodeURIComponent(i.target),type:i.type},ignore_warning:u},(function(i){if(i.error)return l.handleError(r,i.error),!0;t.getOriginField().val(""),t.getTargetField().val(""),l.find(".no-items").remove();const o=l.createRedirectRow(i.origin,i.target,i.type,i.info);e("form#"+c).find("#the-list").prepend(o),l.openDialog(wpseoPremiumStrings.redirect_added)})),!0},this.updateRedirect=function(){const r=new n(s.getForm()),i=new a(r,c);if(!1===i.validate())return!1;const d=i.getFormValues(),p=s.getRow(),h=this.rowCells(p);return l.post({action:"wpseo_update_redirect_"+c,ajax_nonce:e(".wpseo_redirects_ajax_nonce").val(),old_redirect:{origin:encodeURIComponent(h.origin.html()),target:encodeURIComponent(h.target.html()),type:encodeURIComponent(h.type.html())},new_redirect:{origin:encodeURIComponent(d.origin),target:encodeURIComponent(d.target),type:encodeURIComponent(d.type)},ignore_warning:u},(function(r){if(r.error)return l.handleError(i,r.error),!0;if(h.origin.html(_.escape(r.origin)),"regex"!==c&&h.origin.attr("href",_.escape(t+r.origin)),h.target.html(_.escape(r.target)),410===r.type||451===r.type)h.target.replaceWith(e("<div>").addClass("val remove-slashes"));else{const i="/"===r.target?"val remove-slashes":"val";h.target.replaceWith(e("<a>").addClass(i).attr({href:_.escape(t+o(r.target)),target:"_blank"}).html(_.escape(r.target)))}h.type.html(_.escape(r.type)),s.remove(),l.openDialog(wpseoPremiumStrings.redirect_updated)})),!0},this.deleteRedirect=function(t){const i=this.rowCells(t);(function(e,t,i,o="plain"){return r()({method:"POST",url:wpApiSettings.root+"yoast/v1/redirects/delete",headers:{"X-WP-Nonce":wpApiSettings.nonce},data:{origin:e,target:t,type:i,format:o}})})(i.origin.text(),i.target.text(),i.type.html(),c).then((r=>{t.fadeTo("fast",0).slideUp((function(){e(this).remove()})),l.openDialog(r)})).catch((e=>{this.dialog(e.title,e.message,"error")}))},this.setup=function(){let t;e("body").append('<div id="YoastRedirectDialog"><div id="YoastRedirectDialogText"></div></div>'),e(window).on("beforeunload",(function(){if(e("#the-list").find("#inline-edit").length>0)return wpseoPremiumStrings.unsaved_redirects})),e(".redirect-table-tab").on("change","select[name=wpseo_redirects_type]",(t=>{const r=parseInt(e(t.target).val(),10),o=e(t.target).closest(".wpseo_redirect_form").find(".wpseo_redirect_target_holder");jQuery.inArray(r,i)>-1?e(o).hide():e(o).show()})),e(".wpseo-new-redirect-form").on("click",".button-primary",(function(){return p=function(){l.addRedirect()},l.addRedirect(),h=e(this),!1})).on("keypress","input",(function(e){13===e.which&&(p=function(){l.addRedirect()},e.preventDefault(),l.addRedirect())})),e(".wp-list-table").on("click",".redirect-edit",(function(r){t=e(r.target).closest("tr"),r.preventDefault(),l.editRow(t),h=e(this)})).on("click",".redirect-delete",(function(r){t=e(r.target).closest("tr"),r.preventDefault(),l.deleteRedirect(t),h=e("#cb-select-all-1")})).on("keypress","input",(function(e){13===e.which&&(p=function(){l.updateRedirect()},e.preventDefault(),l.updateRedirect())})).on("click",".save",(function(){p=function(){l.updateRedirect()},p()})).on("click",".cancel",(function(){p=null,s.remove(),t.find(".redirect-edit").trigger("focus")}))},l.setup()},e((function(){e.each(e(".redirect-table-tab"),(function(t,r){e(r).wpseoRedirects(e(r).attr("id"))}))}))}(jQuery)})();